var iFileName = "Homebrew Syntax - Kanala Class.js";
RequiredSheetVersion(13);

ClassList["kanala"] = {

	name : "Kanala",

	regExpSearch : /^(?=.*kanala).*$/i,

	source : ["HB", 0],

	primaryAbility : "Strength or Dexterity",

	prereqs : "Strength 13 or Dexterity 13",

	die : 10,

	improvements : [0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 5, 5],

	saves : ["Cha", "Con"],

	skills : ["\n\n" + toUni("Kanala") + ": Choose two from Arcana, Athletics, History, Insight, Intimidation, Religion, and Sleight of Hand.", "\n\n" + toUni("Kanala") + ": No skills gained."],

	armor : [
		[true, true, false, true],
		[true, true, false, true]
	],

	weapons : [
		[true, true, false],
		[true, true, false]
	],

	equipment : "Kanala starting equipment:\n \u2022 A martial melee weapon of my choice;\n \u2022 A sling and a pouch containing 20 sling bullets;\n \u2022 Studded leather armor -or- scale mail -or- 40 gp;\n \u2022 A component pouch and an explorer’s pack\n\nAlternatively, choose 5d4 \xD7 10 gp worth of starting equipment instead of both the class' and the background's starting equipment.",

	subclasses : ["Empowered Bond", [""]],

	attacks : [1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],

	spellcastingFactor : 2,

	spellcastingKnown : {

		cantrips : [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],

		spells : [2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11],

		prepared : true,

	},

	spellcastingList : {

		class : "kanala",

		spells : ["color spray", "comprehend languages", "cure wounds", "detect evil and good", "detect magic", "detect poison and disease", "disguise self", "expeditious retreat", "inflict wounds", "jump", "longstrider", "made armor", "shield", "thunderwave", "alter self", "barkskin", "blur", "darkvision", "enhance ability", "flame blade", "invisibility", "lesser restoration", "magic weapon", "mirror image", "misty step", "pass without trace", "protection from poison", "see invisiblity", "spider climb", "bestow curse", "blink", "fear", "protection from energy", "remove curse", "revivify", "tongues", "vampiric touch", "death ward", "fire shield", "freedom of movement", "stone shape", "stoneskin", "cone of cold", "greater restoration", "mislead", "raise dead"],
	},

	features : {

		"gift source" : {
			name : "Gift Source",
			source : ["HB", 0],
			minlevel : 1,
			description : "\n   " + "The source of my power determines my early capabilitiesas well as the spellcasting ability for my \"Pact Magic\" feature. I choose my gift source from the choices given.",
			choices : ["Conjoined Soul", "Kanala Prosthesis", "Latent Energy", "Relic of Power", "Symbiotic Creature", "Transformative Serum"],
			choicesNotInMenu : false,
			"conjoined soul" : {
				name : "Conjoined Soul",
				description : "\n   " + "The soul of another entity, perhaps the ghost of an ancient hero or the vengeful spirit of a long-dead culture, has become entwined with my own. The knowledge of my second soul carries over to me, allowing me gain proficiency in one skill, one tool, and one language of my choice. When I finish along rest, I can replace each of these proficiencies with another one of the same type.",
				abilitySave : 6,
				toolProfs : ["Any tool"],
				languageProfs : 1,
				skillstxt : "Choose any skill",
			},

			"kanala prosthesis" : {
				name : "Kanala Prosthesis",
				description : "\n   " + "As a bonus action, I can send out a magic pulse from my prosthesis to detect any creatures that can see me. Creatures I'm already aware of aren't detected. I learn the size of each detected creature, as well as roughly which direction it is in. Additionally, any invisible creatures and objects within 20 feet of me become visible until the start of my next turn. I can use this gift a number of times equal to my proficiency bonus, and I regain all expended uses when I finish a long rest.",
				abilitySave : 4,
				usages : [2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 6, 6],
				recovery : "long rest",
				action : ["bonus action"]
			},

			"latent energy" : {
				name : "Latent Energy",
				description : "\n   " + "The gift of latent energy is represented by a connection to a unique hidden force from within or without myself that may whisper to me when all else is quiet. With it, my Armor Class equals 10 + my Dexterity modifier + my Wisdom modifier while I'm wearing no armor and not wielding a shield, but I lose any armor proficiencies I gained from taking a level in this class.",
				abilitySave : 5,
				armor : [false, false, false, false],
				extraAC : [{
					mod : "Wis",
					magic : false,
					text : "I add my Wisdom modifier to AC while I'm not wearing armor or wielding shield.",
					stopeval : function (v) { return v.wearingArmor || v.usingShield; }
				}],
			},

			"relic of power" : {
				name : "Relic of Power",
				description : "\n   " + "A strange artifact has chosen, or been forced, to select me as the heir to its power. I gain the \"Locus Forms\" feature, but I only know one locus form. At 2nd level, I learn two more to reach a total of three locus forms known. As an action, I can give a small fragment of the artifact to a willing creature within 5 feet of me, choosing a locus form I know. Until I retrieve the fragment or spend an hour invoking its return to the artifact, the creature can use the chosen locus form, but I cannot. The form still uses your spellcasting ability modifier as normal.",
				abilitySave : 4,
				action : ["action"],
				bonusClassExtrachoices : [{
					'class' : "kanala",
					feature : "locus forms",
					bonus : ["fixed 1", "fixed 3", "fixed 3", "fixed 3", "fixed 3", "fixed 3", "fixed 3", "fixed 3", "fixed 3", "fixed 3", "fixed 3", "fixed 3", "fixed 3", "fixed 3", "fixed 3", "fixed 3", "fixed 3", "fixed 3", "fixed 3", "fixed 3"]
				}],
			},

			"symbiotic creature" : {
				name : "Symbiotic Creature",
				description : "\n   " + "I share my body with a creature that affords me fantastic powers in exchange for food. I can allow it to consume the edible remains of a Medium or smaller creature within my reach over the course of 1 minute. The first time this occurs, after I complete a long rest, I regain a number of HP equal to 1d4 + my kanala level.",
				abilitySave : 5,
			},

			"transformative serum" : {
				name : "Transformative Serum",
				description : "\n   " + "An experimental elixir has altered the makeup of my body, allowing me to gain great strength temporarily. As a bonus action, I gain advantage on Strength checks and Strength saving throws for the next minute. I can use this gift a number of times equal to my proficiency bonus, and I regain all expended uses when I finish a long rest.",
				abilitySave : 6,
				usages : [2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 6, 6],
				recovery : "long rest",
				action : ["bonus action"]
			},
		},

		"pact magic" : {
			name : "Pact Magic",
			source : ["HB", 0],
			minlevel : 1,
			description : "\n   " + "I can use my gift to cast spells. However, my magic does not appear in the same way as that of wizards or sorcerers; instead, casting a spell causes my locus to coalesce or alter its appearance as the magic physically flows out from it. My magical effects are produced through my locus, as such, I must have an empty hand when I cast any spell.",
		},

		"locus forms" : {
			name : "Locus Forms",
			source : ["HB", 0],
			minlevel : 2,
			description : "\n   " + "I know three locus forms of my choice, getting more as I gain levels in this class. Additionally, when I gain a level in this class, I can choose one of the forms I know and replace it with another form that I could learn at that level.",
			extraname : "Locus Forms",
			extrachoices : ["Appendage", "Bolster (prereq: 10th level kanala)", "Dissociation (prereq: Wisdom 13 or higher)", "Elevent (prereq: 7th level kanala and Locus Energy form)", "Flare", "Guise (prereq: 7th level kanala and Charisma 13 or higher)", "Hasten (prereq: 4th level kanala)", "Hook", "Implement (prereq: 4th level kanala)", "Introspect (prereq: 4th level kanala and Intelligence 13 or higher)", "Leash", "Locus Energy", "Locus Weapon", "Mend", "Metamorphosis (prereq: 14th level kanala)", "Negate (prereq: 14th level kanala)", "Practice", "Prolong (prereq: 4th level kanala)", "Retaliate (prereq: 10th level kanala)", "Ruse (prereq: 14th level kanala and Intelligence 13 or higher)", "Splitter (prereq: 7th level kanala and Locus Weapon form)", "Track (prereq: 4th level kanala)", "Trip", "Weave (prereq: 7th level kanala)"],
			extraTimes : levels.map(function (n) {
				return n < 2 ? 2 : n < 4 ? 3 : n < 7 ? 4 : n < 10 ? 5 : n < 14 ? 6 : n < 18 ? 7 : 8;
			}),
			"appendage" : {
				name : "Appendage",
				description : "An appendage extends straight out from my locus to a point that I can see within 30 ft. The appendage can manipulate an object, open an unlocked door or container, stow or retrieve an item from an open container, or pour the contents out of a vial before it is retracted. The appendage can fit through a space as narrow as 1 inch wide. It cannot attack, activate magical items, or carry more than 10 pounds.",
				action : ["action"]
			},
			"bolster (prereq: 10th level kanala)" : {
				name : "Bolster",
				description : "My locus spreads along my skin and quickly scabs over my cuts and scrapes. I gain a number of temporary HP equal to 1d8 + my spellcasting ability modifier.",
				prereqeval : function(v) { return classes.known.kanala.level >= 10; },
				action : ["bonus action"]
			},
			"dissociation (prereq: wisdom 13 or higher)" : {
				name : "Dissociation",
				description : "I focus my hearing in order to listen to a specific sound, including verbal speech, that is originating from a point within 200 ft. for one minute. In order to so, I must either be able to faintly hear the sound I wish to focus on or see the sound's source. While focusing, I can hear the sound clearly and even discern its source if I'm familiar with it. I can also choose to focus on a point that I can see within range and hear sounds as if I were standing in the chosen spot. While focusing this way, I'm deaf to the sounds in my immediate vicinity.",
				prereqeval : function(v) { return What('Wis') >= 13; },
				action : ["action"]
			},
			"elevent (prereq: 7th level kanala and locus energy form)" : {
				name : "Elevent",
				description : "I instantly release my stored energy in a 15 ft. cone in front of me, deactivating the locus energy form and forcing each creature within range to succeed on a Dexterity saving throw or take 3d6 damage of the chosen type. This damage increases to 4d6 when I reach 11th level in this class.",
				prereqeval : function(v) { return classes.known.kanala.level >= 7 && GetFeatureChoice('class', 'kanala', 'locus forms') == 'locus energy'; },
				action : ["action"]
			},
			"flare" : {
				name : "Flare",
				description : "My locus begins to shed bright light in a 20-foot radius and dim light for an additional 20 feet. When I activate this form, or as a bonus action while it is active, I can send the light to a spot that I can see within 60 ft. I can recall the light back to my hand by using a bonus action, but it is automatically recalled when it exceeds the form's range.",
				action : ["bonus action"]
			},
			"guise (prereq: 7th level kanala and charisma 13 or higher)" : {
				name : "Guise",
				description : "For one minute, I have advantage on all Charisma check sdirected at one creature of my choice. When the form deactivates, the creature must make a Wisdom saving throw. If it succeeds, it realizes that I used magic to change its mood and becomes hostile toward me. A creature prone to violence might attack me. Another creature might seek retribution in other ways (at the GM's discretion), depending on the nature of my interaction with it.",
				prereqeval : function(v) { return classes.known.kanala.level >= 7 && What('Cha') >= 13; },
				action : ["action"]
			},
			"hasten (prereq: 4th level kanala)" : {
				name : "Hasten",
				description : "This form increases my speed by 20 feet and doubles my jump distance until the end of my turn.",
				prereqeval : function(v) { return classes.known.kanala.level >= 4; },
				action : ["bonus action"]
			},
			"hook" : {
				name : "Hook",
				description : "My locus attaches to a solid surface I can see within range, such as a wall or ceiling. While attached this way, the locus has the same properties as a rope. I can lengthen or shorten my locus by using your movement, allowing me to pull myself to the attachment point and suspend myself. I can also use my locus to swing if I have enough room to do so and I'm not carrying weight in excess of my carrying capacity. If I would be forced to move more than 30 feet away from the attachment point, such as by the thunderwave spell, the form deactivates immediately.",
				action : ["bonus action"]
			},
			"implement (prereq: 4th level kanala)" : {
				name : "Implement",
				description : "My locus morphs into various handheld implements. I can use these implements to perform an action that would normally require a specific tool or set of tools. I can add half my proficiency bonus to any ability check I make while using these implements as long as the ability check doesn’t already include my proficiency bonus.",
				prereqeval : function(v) { return classes.known.kanala.level >= 4; },
				action : ["bonus action"]
			},
			"introspect (prereq: 4th level kanala and intelligence 13 or higher)" : {
				name : "Introspect",
				description : "I touch a creature that has a speed of 0, is incapacitated, or is willing. I then force it to remember a subject that I choose, such as its boss, a treasure, or last night's dinner. One of its relevant memories, no longer than 6 seconds, then surfaces in the creature's mind as well as my own. If the memory includes speech, it is limited to 15 words or less. The memory's detail and level of accuracy both depend on the creature's Intelligence and sanity. For example, using this form on a pet might allow me to visualize the owner, but thei rspeech would be heard as unintelligible gibberish if the pet does not comprehend their language. Repeated use of this form on the same creature makes subsequent memories more obscured than the last, with them becoming incomprehensible after three such uses. This effect is reset after 24 hours of not being affected by the form.",
				prereqeval : function(v) { return classes.known.kanala.level >= 4 && What('Int') >= 13; },
				action : ["action"]
			},
			"leash" : {
				name : "Leash",
				description : "For the next minute, while this form is active, the target of any grapple attempt I make can be a creature within the 20 ft., but I must still obey the other restrictions of grappling. This means that unless I have another way to grapple, I must still use one attack from my Attack action to attempt a grapple. The hand that I use to grapple a creature this way must be the same hand that I used to activate this form. If I target a creature that is not within arm's reach, a sizable leash reaches out to it. If I succeed in grappling the creature, the leash connects it to my arm while  I'm more than an arm's length away from it. While grappling a creature this way, I can use my movement to move either the creature or myself. My speed is not halved when doing so. Creatures can attack the leash (AC 11 + my proficiency bonus), but all damage it takes is taken by me instead. The grapple ends if the target is ever outside of the form's range.",
				action : ["bonus action"]
			},
			"locus energy" : {
				name : "Locus Energy",
				description : "I begin stockpiling energy of one the following damage types of my choice: acid, cold, fire, lightning, necrotic, or thunder. While this form is active, my weapon attacks deal an extra 1d4 damage of the chosen type on a hit. If the weapon is a locus weapon, all bludgeoning, piercing, and slashing damage that it deals becomes damage of the chosen type until this form is deactivated. The form deactivates at the beginning of my next turn unless I use my bonus action to keep it active.",
				action : ["bonus action"]
			},
			"locus weapon" : {
				name : "Locus Weapon",
				description : "When I take the Attack action on my turn, I can activate this form and create a locus weapon in my empty hand. I can choose the form that this melee weapon takes each time I create it. I'm proficient with it and can't be disarmed of it while I wield it. If I plan to engage in two-weapon fighting, I can create two locus weapons at once, assuming I have two empty hands to work with. If I can make multiple attacks as part of the Attack action, I can freely change the form of my locus weapon or create a new one before each attack. At the end of my turn, all of my locus weapons retract back into my locus and disappear. My locus can assimilate a magic melee weapon and turn it into a locus weapon by accommodating the weapon over the course of 1 hour, which can be done during a short rest. The weapon must be within my grasp during this time. After 1 hour, the weapon melds with my locus and becomes a locus weapon for me, allowing me to choose it whenever I create a locus weapon. I can't affect an artifact weapon in this way. If the weapon is sentient, I must gain its consent before accommodating it. Sentient locus weapons share my senses and converse telepathically with me. Accommodating a weapon this way does not automatically attune me to it. I can have up to three accommodated weapons. If I attempt to accommodate a fourth magic weapon, I must reconstitute one of the other three. That weapon appears at my feet and ceases to be one of my locus weapons. If I die, my accommodated weapons reconstitute immediately.",
				action : ["action", "(as part of an Attack)"]
			},
			"mend" : {
				name : "Mend",
				description : "This form repairs one break or tear in an object I touch, such as a cracked window pane or a warped pan. As long as the break or tear is no larger than 1 foot in any dimension, I mend it, leaving no trace of the former damage. This form can physically repair a magic item or construct, but the form can't restore magic to such an object. It can also heal constructs in the same manner as the mending spell.",
				action : ["action"]
			},
			"metamorphosis (prereq: 14th level kanala)" : {
				name : "Metamorphosis",
				description : "I gain the ability to cast the polymorph spell this turn, targeting myself. If the spell is cast this way, I do not need to provide material components. I must still use my action and expend a spell slot to cast the spell, as normal. I retain my Intelligence, Wisdom, and Charisma scores once I transform. I also retain all of my skill and saving throw proficiencies, in addition to gaining those of the chosen creature. If the creature has the same proficiency as me and the bonus in its stat block is higher than mine, I use the creature's bonus instead of mine. Additionally, my transformation does not limit my ability to use my locus forms.",
				prereqeval : function(v) { return classes.known.kanala.level >= 14; },
				action : ["bonus action"]
			},
			"negate (prereq: 14th level kanala)" : {
				name : "Negate",
				description : "My locus tries to counteract the magical or physical force that is overwhelming me. I gain a bonus to the triggering saving throw equal to my spellcasting ability modifier.",
				prereqeval : function(v) { return classes.known.kanala.level >= 14; },
				action : ["reaction", " (in response to a failed throw)"]
			},
			"practice" : {
				name : "Practice",
				description : "I change a minor aspect of my body. Choose one of the following effects each time I activate this form:\n   My locus takes on the visage of a creature I'm familiar with, becoming akin to a hand puppet.\n   I groom myself without moving a finger. For example, I could smooth my hair or adjust my undergarments.\n   I alter the appearance of my eyes, teeth, or both.\n   My locus layers thinly over my skin, allowing me to form scars, tattoos, or other markings on my body.\n   I begin to emit a familiar scent of my choice.",
				action : ["action"]
			},
			"prolong (prereq: 4th level kanala)" : {
				name : "Prolong",
				description : "When I cast a spell of 5th-level or lower that has a duration of 1 minute or longer, I can activate this form as part of the casting process. If I do, the spell persists until this form is deactivated instead of until it reaches its maximum duration. This form immediately deactivates if the spell ends early. If the spell must be maintained with concentration, the Constitution saving throws I make to keep my concentration are made with disadvantage.",
				prereqeval : function(v) { return classes.known.kanala.level >= 4; },
			},
			"retaliate (prereq: 10th level kanala)" : {
				name : "Retaliate",
				description : "My locus seeks out the creature that harmed me, punishing the offender even if I can't see them myself. The creature instantly takes necrotic damage equal to 1d10 + my spellcasting ability modifier as long as it is within 20 ft. of me.",
				prereqeval : function(v) { return classes.known.kanala.level >= 10; },
				action : ["reaction", " (in response to being hit by a creature)"]
			},
			"ruse (prereq: 14th level kanala and intelligence 13 or higher)" : {
				name : "Ruse",
				description : "I quickly attempt to fool the creature's vision, making it think as though my existence was just a trick of the light. The creature must make an Intelligence saving throw. If it fails, me and my held equipment are considered to be invisible to that creature for as long as this form is active. The form deactivates early if the target is ever outside of the form's range or if I harm it in any way.",
				prereqeval : function(v) { return classes.known.kanala.level >= 14 && What('Int') >= 13; },
				action : ["reaction", " (in response to being seen by a creature within 120 ft. for the first time)"]
			},
			"splitter (prereq: 7th level kanala and locus weapon form)" : {
				name : "Splitter",
				description : "I create a special locus weapon with the finesse and two-handed properties. It deals 7d4 slashing damage on a hit and counts as magical for the purpose of overcoming resistance and immunity to non-magical attacks and damage. As with all other locus weapons, it disappears at the end of my turn. Each time I attack with this locus weapon, I can target up to two creatures that are both within 5 feet of me. I make a separate attack roll for each target.",
				prereqeval : function(v) { return classes.known.kanala.level >= 7 && GetFeatureChoice('class', 'kanala', 'locus forms') == 'locus weapon'; },
				action : ["bonus action"]
			},
			"track (prereq: 4th level kanala)" : {
				name : "Track",
				description : "I send a tiny part of my locus to a creature that is attempting to break line of sight with me. I make a ranged spell attack against the target. On a hit, the creature takes 1d4 necrotic damage, and I know its location as long as it remains within 90 ft. for the next 10 minutes. While this form is active, I can use my bonus action to instantly deal 1d4 necrotic damage to the creature again. The form deactivates early if the creature dies or is ever outside of the form's range. Alternatively, I can use my action to touch a willing creature and apply the tracking effect of this form to it without making an attack or dealing damage.",
				prereqeval : function(v) { return classes.known.kanala.level >= 4; },
				action : ["reaction", " (in response to a creature within sight attempts to either burrow, move behind cover, turn invisible, or enter the Ethereal Plane)"]
			},
			"trip" : {
				name : "Trip",
				description : "My locus grasps at the creature's limbs, forcing it to make a Strength saving throw. If it fails, the creature takes 1d12 necrotic damage and is knocked prone.",
				action : ["reaction", " (in response to a creature moving out of my range)"]
			},
			"weave (prereq: 7th level kanala)" : {
				name : "Weave",
				description : "Until the end of my turn, I can move through the space of any creature, regardless of its size, without treating occupied spaces as difficult terrain. Additionally, my movement does not provoke opportunity attacks for the rest of the turn. As normal, I can't willingly end my turn in another creature's space.",
				prereqeval : function(v) { return classes.known.kanala.level >= 7; },
				action : ["bonus action"]
			},
		},

		"subclassfeature3" : {
			name : "Empowered Bond",
			source : ["HB", 0],
			minlevel : 3,
			description : "\n   " + "My relationship with my gift has matured to the point where I gain specialized benefits from it. Choose from the Bond of the Collector, the Bond of the Host, the Bond of the Lionheart, the Bond of the Savant, or the Bond of the Vessel.",
		},

		"gift of protection" : {
			name : "Gift of Protection",
			source : ["HB", 0],
			minlevel : 7,
			description : "\n   " + "While I'm not incapacitated, acid, cold, fire, lightning, necrotic, poison, psychic, radiant, and thunder damage that I take is reduced by 3.",
		},

		"extraordinary attack" : {
			name : "Extraordinary Attack",
			source : ["HB", 0],
			minlevel : 11,
			description : "\n   " + "I can now attack thrice, instead of twice, when I take the Attack action on my turn. When I make my third attack as part of the Attack action, I must add my spellcasting ability modifier, instead of Strength or Dexterity, to the attack and damage rolls.",
		},

		"shared physique" : {
			name : "Shared Physique",
			source : ["HB", 0],
			minlevel : 14,
			description : "\n   " + "I can no longer be forced to take actions against my will by effects or spells such as dominate person. Additionally, my gift now replaces all missing limbs, functioning identically to a limb it replaces.",
		},

		"locus combatant" : {
			name : "Locus Combatant",
			source : ["HB", 0],
			minlevel : 20,
			description : "\n   " + "On my turn, I can take one additional bonus action. This additional bonus action can only be used to activate a locus form I know.",
		},
	}
}

AddSubClass(

	"kanala",

	"bond of the collector",

	{

		regExpSearch : /^(?=.*bond)(?=.*of)(?=.*the)(?=.*collector).*$/i,

		subname : "Bond of the Collector",

		source : ["HB", 0],

		toolProfs : ["Musical instrument or gaming set", 1],

		spellcastingExtra : ["hunter's mark", "identify", "find traps", "locate object", "daylight", "tiny hut", "fabricate", "locate creature", "creation", "legend lore"],

		features : {

			"subclassfeature3" : {
				name : "Always Prepared",
				source : ["HB", 0],
				minlevel : 3,
				description : "\n   " + "As an action, I can conjure one piece of Adventuring Gear, such as one arrow or one day's rations, from the opening of an opaque container within my reach. If the item can't fit in my hand, it appears in an unoccupied space within 5 ft. of me. The gp value of the item can't be more than 5 times my kanala level, which is also my gp limit for this feature. I can conjure multiple items this way, using a separate action for each one, but their sum total value can't surpass the gp limit. Any item valued under 1 gp instead has a value of 1 gp for this limit, and a potion of healing has a value of 10 gp for this limit. I can also conjure a gaming set or musical instrument that I'm proficient with, treating its value as 2 gp for this limit regardless of its normal value. When I finish my next long rest, each item conjured this way disappears if it hasn't already been consumed or destroyed, and my sum total value of conjured items returns to 0 gp. I can sell items that I conjure with this feature, but the buyer will probably be upset when their purchase is gone in the morning.",
				additional : ["", "", "15 gp", "20 gp", "25 gp", "30 gp", "35 gp", "40 gp", "45 gp", "50 gp", "55 gp", "60 gp", "65 gp", "70 gp", "75 gp", "80 gp", "85 gp", "90 gp", "95 gp", "100 gp"],
			},
			"subclassfeature6" : {
				name : "Foolproof Fail-Safe",
				source : ["HB", 0],
				minlevel : 6,
				description : "\n   " + "When I take damage, I can use my reaction to reduce all incoming damage to 0 for that single instance. If I take damage from multiple sources at once, such as a spike trap and a fireball contained in a glyph of warding, I must choose one source from among them to have its damage reduced. Once I use this feature, I can't do so again until I finish a long rest. At 15th level, I can use this feature twice between long rests.",
				usages : [0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2],
				recovery : "long rest",
				action : ["reaction", " (when I take damage)"]
			},
			"subclassfeature10" : {
				name : "Combat Preparation",
				source : ["HB", 0],
				minlevel : 10,
				description : "\n   " + "By using my \"Always Prepared\" feature, I can now conjure magical bombs. As an action, I can throw a conjured bomb up to 60 feet, causing it to detonate on impact. Each bomb has its own gp value and detonation effect, as shown in the Magical Bombs table. I can only have one magical bomb conjured at a time.",
				toNotesPage : [{
					name : "Magical Bombs Table",
					source : ["HB", 0],
					popupName : "Magical Bombs Table",
					note : "\n   Bomb           Value   Detonation Effect\n   Black Dragon   30 gp   Each creature in a 10-foot radius sphere centered on the detonation point must make a Dexterity saving throw against my spell save DC, taking 8d8 acid damage on a failed save or half as much on a success.\n   Myst           10 gp   Non-magical flames in a 30-foot radius sphere centered on the detonation point are extinguished, and the area becomes heavily obscured for the next 10 minutes or until a wind of moderate or greater speed disperses the mist.\n   Tie-Down       20 gp   A 20-foot radius, 90-foot high cylinder of space centered on the detonation point becomes magically charged. The ground within this zone is difficult terrain, and the flying speed (if any) of creatures there is reduced to 10 feet. The zone returns to normal after 1 minute."
				}],
			},
			"subclassfeature15" : {
				name : "Trivial Pursuit",
				source : ["HB", 0],
				minlevel : 15,
				description : "\n   " + "As an action, I can try to exhaust a creature that I can see within 20 feet of me, either with my gift or my nonstop blathering. That creature must succeed on a Constitution saving throw against my spell save DC or suffer three levels of exhaustion. This feature can't cause a creature to die of exhaustion, however. At the end of each of its turns, the creature's exhaustion level is reduced by 1 if it is conscious and not within 20 feet of me. This reduction can occur up to three times per use of this feature, or until the creature returns to the exhaustion level it had beforehand. Once I use this feature, I can't do so again until I finish a long rest.",
				usages : 1,
				recovery : "long rest",
				action : ["action"]
			},
			"subclassfeature18" : {
				name : "Peerless Preparation",
				source : ["HB", 0],
				minlevel : 18,
				description : "\n   " + "I can now use my bonus action to conjure items with my \"Always Prepared\" feature, and my gp limit is doubled for it.",
			},
		}
	}
);

AddSubClass(

	"kanala",

	"bond of the host",

	{

		regExpSearch : /^(?=.*bond)(?=.*of)(?=.*the)(?=.*host).*$/i,

		subname : "Bond of the Host",

		source : ["HB", 0],

		spellcastingExtra : ["false life", "inflict wounds", "blindness/deafness", "sudden death", "bestow curse", "vampiric touch", "blight", "cruel facade", "contagion", "wave of rust"],

		features : {

			"subclassfeature3" : {
				name : "Necrotic Adept",
				source : ["HB", 0],
				minlevel : 3,
				description : "\n   " + "Spells I cast and locus forms I activate ignore resistance to necrotic damage. In addition, when I roll damage for a spell I cast or locus form I activated that deals necrotic damage, I can treat any 1 on a damage die as a 2.",
			},
			"subclassfeature3.1" : {
				name : "One with Death",
				source : ["HB", 0],
				minlevel : 3,
				description : "\n   " + "Anytime a kanala spell I cast deals necrotic damage, I can choose one affected creature and deal extra necrotic damage to it equal to my spellcasting ability modifier. Additionally, I gain resistance to necrotic damage.",
				dmgres : ["Necrotic"],
			},
			"subclassfeature6" : {
				name : "Improved Bond Spells",
				source : ["HB", 0],
				minlevel : 6,
				description : "\n   " + "Whenever I cast one of my bond spells, I can cast it as if I had expended a spell slot of one level higher than the spell slots provided by my Pact Magic feature, up to a maximum of 5th level. I can do so whether or not I expended a spell slot to cast the spell.",
			},
			"subclassfeature10" : {
				name : "Necrotic Expert",
				source : ["HB", 0],
				minlevel : 10,
				description : "\n   " + "The benefits of the \"Necrotic Adept\" feature now apply to any weapon attacks I make, locus forms I activate, features I use, and spells I cast that deal necrotic damage.",
			},
			"subclassfeature15" : {
				name : "Invasive Rot",
				source : ["HB", 0],
				minlevel : 15,
				description : "\n   " + "I can use my action to make a ranged spell attack against up to five creatures that I can see within 60 ft. of me. On a hit, my gift begins to destroy the target from the inside, dealing 2d12 necrotic damage and leaving it tainted. On each of my subsequent turns, I can use a bonus action to deal 1d8 necrotic damage to each tainted creature automatically. At the end of each of a tainted creature's turns, it can make a Constitution saving throw against my spell save DC. On a success, it is no longer tainted. Once I use this feature, I can't use it again until I finish a long rest.",
				usages : 1,
				recovery : "long rest",
				action : ["action"]
			},
			"subclassfeature18" : {
				name : "Necrotic Master",
				source : ["HB", 0],
				minlevel : 18,
				description : "\n   " + "Once per turn, when I deal necrotic damage to a creature, I can regain HP equal to half the amount of necrotic damage the creature takes. This feature can only restore me to up to half of my HP maximum.",
			},
		}
	}
);

AddSubClass(

	"kanala",

	"bond of the lionheart",

	{

		regExpSearch : /^(?=.*bond)(?=.*of)(?=.*the)(?=.*lionheart).*$/i,

		subname : "Bond of the Lionheart",

		source : ["HB", 0],

		spellcastingExtra : ["command", "heroism", "find steed", "hold person", "fly", "haste", "banishment", "compulsion", "geas", "hold monster"],

		features : {

			"subclassfeature3" : {
				name : "Improved Locus Weapon",
				source : ["HB", 0],
				minlevel : 3,
				description : "\n   " + "I gain the locus weapon form if I don't already know it. At the end of my turn after creating a locus weapon, I can choose to keep it in my grasp instead of having it disappear. If I do, I gain a +2 bonus to AC while the weapon is in my grasp and I'm not wielding a shield. The bonus lasts until I use my reaction or until the start of my next turn, when the locus weapon retracts back into my locus and disappears as normal. If I already know the locus weapon form, I gain another locus form that I meet the prerequisites for. The form I gain from this feature doesn't count against the number of locus forms I know.",
				bonusClassExtrachoices : [{
					'class' : "kanala",
					feature : "locus forms",
					bonus : 1
				}],
			},
			"subclassfeature6" : {
				name : "Offensive Action",
				source : ["HB", 0],
				minlevel : 6,
				description : "\n   " + "If I take an action other than the Attack action, I can make one weapon attack as abonus action. I can activate the locus weapon form before making this attack as part of the same bonus action. I can use this feature a number of times equal to my spellcasting ability modifier (minimum of once). I regain all expended uses when I finish a long rest.",
				recovery : "long rest",
			},
			"subclassfeature10" : {
				name : "Lion's Courage",
				source : ["HB", 0],
				minlevel : 10,
				description : "\n   " + "I'm immune to being frightened, and when another creature attempts to frighten me, I instead regain 2d6 HP as the mere thought of its futile attempt emboldens me.",
				savetxt : {

					immune : ["frightened"],
				},
			},
			"subclassfeature15" : {
				name : "Power Overwhelming",
				source : ["HB", 0],
				minlevel : 15,
				description : "\n   " + "I can use my bonus action to enter an empowered state and conduct the energy of my inner power all around me. When I do, each creature I choose within 5 ft. of me must succeed on a Strength saving throw against my spell save DC or be pushed 5 ft. away from me and knocked prone. I remain in this state for 1 minute. During that time, my weapon attacks score a critical hit on a roll of 17–20. After I use this feature, I must finish a long rest before I can use it again. At 18th level, I can use it twice between long rests.",
				usages : 1,
				recovery : "long rest",
				action : ["bonus action"]
			},
			"subclassfeature18" : {
				name : "Pride of the Willful",
				source : ["HB", 0],
				minlevel : 18,
				description : "\n   " + "My weapon attacks now score a critical hit on a roll of 19 or 20, and when I score a critical hit on a creature, it becomes frightened of me until the end of its next turn.",
				calcChanges : {
					atkAdd : [
						function (fields, v) {
							if (!v.CritChance && classes.known["kanala-bond of the lionheart"]) {
								fields.Description += (fields.Description ? '; ' : '') + 'Crit on 19-20';
								v.CritChance = 19;
							};
						},
						"My weapon attacks score a critical on a to hit roll of both 19 and 20.",
						19
					]
				}
			},
		}
	}
);

AddSubClass(

	"kanala",

	"bond of the savant",

	{

		regExpSearch : /^(?=.*bond)(?=.*of)(?=.*the)(?=.*savant).*$/i,

		subname : "Bond of the Savant",

		source : ["HB", 0],

		spellcastingExtra : ["find familiar", "floating disk", "calm emotions", "detect thoughts", "counterspell", "dispel magic", "arcane eye", "confusion", "modify memory", "telepathic bond"],

		features : {

			"subclassfeature3" : {
				name : "Ritual Casting",
				source : ["HB", 0],
				minlevel : 3,
				description : "\n   " + "I can cast a kanala spell that you know as a ritual if that spell has the ritual tag.",
			},
			"subclassfeature3.1" : {
				name : "Magical Aptitude",
				source : ["HB", 0],
				minlevel : 3,
				description : "\n   " + "I gain a single 1st-level spell slot to use as I see fit. I can expend it to cast any spell of its level or lower from any spell list, and I regain it after finishing a long rest. Casting a spell this way does not mean I know that spell. My locus actually produces a magical effect that imitates the spell I wished to cast, even if I already know it. The spell slot's level increases as I gain more levels in the kanala class: it becomes 2nd-level at 6th level, 3rd-level at10th level, 4th-level at 15th level, and 5th-level at 18th level.",
				additional : ["", "", "1st level", "1st level", "1st level", "2nd level", "2nd level", "2nd level", "2nd level", "3rd level", "3rd level", "3rd level", "3rd level", "3rd level", "4th level", "4th level", "4th level", "5th level", "5th level", "5th level"],
			},
			"subclassfeature6" : {
				name : "Expertise",
				source : ["HB", 0],
				minlevel : 6,
				description : "\n   " + "I choose two of my skill proficiencies to gain expertise in. If I choose the proficiency provided by my \"Conjoined Soul\" Gift Source, this expertise moves to the new proficiency when I replace it. At 10th level, I can choose another two of my skill proficiencies to gain expertise.",
				skillstxt : "Choose any two skills to gain expertise in, and an additional two more at 10th level.",
			},
			"subclassfeature10" : {
				name : "Warding Gift",
				source : ["HB", 0],
				minlevel : 10,
				description : "\n   " + "As long as I'm not incapacitated, I have resistance to damage from spells.",
			},
			"subclassfeature15" : {
				name : "Interplanar Espace",
				source : ["HB", 0],
				minlevel : 15,
				description : "\n   " + "At any time during my or another creature's turn, I can use my reaction to slip into a demiplane of my own creation, which borders the plane that I vanish from. While on my demiplane, I can see and hear the plane I originated from, but I can't see anything there more than 120 ft. away. I can affect creatures on the plane that I originated from with attacks, spells, and most other interactions, but I can only be affected by other creatures on my demiplane. Creatures that aren't there can't perceive me or interact with me, unless they have the ability to do so. I remain in my demiplane until the beginning of my second turn after using this feature. At that time, I return to an unoccupied space of my choice that I can see within 60 ft. of the space I vanished from. After I use this feature, I have to wait until I finish a long rest before I can use it again.",
				usages : 1,
				recovery : "long rest",
				action : ["reaction"]
			},
			"subclassfeature18" : {
				name : "Boundless Ability",
				source : ["HB", 0],
				minlevel : 18,
				description : "\n   " + "My spellcasting ability score increases by 2, and my maximum for that score is now 22.",
				improvements : "Boundless Ability: +2 spellcasting ability, to a maximum of 22;",
			},
		}
	}
);

AddSubClass(

	"kanala",

	"bond of the vessel",

	{

		regExpSearch : /^(?=.*bond)(?=.*of)(?=.*the)(?=.*vessel).*$/i,

		subname : "Bond of the Vessel",

		source : ["HB", 0],

		spellcastingExtra : ["jump", "longstrider", "enhance ability", "warding bond", "fly", "haste", "death ward", "stoneskin", "mass cure wounds", "passwall"],

		features : {

			"subclassfeature3" : {
				name : "First In, Last Out",
				source : ["HB", 0],
				minlevel : 3,
				description : "\n   " + "I can now add my spellcasting ability modifier to the result of any death saving throw, Strength check, or Dexterity check I make.",
			},
			"subclassfeature6" : {
				name : "Part of Me",
				source : ["HB", 0],
				minlevel : 6,
				description : "\n   " + "As an action, my gift absorbs up to 3 willing or unconscious creatures of my choice within 10 ft. of me along with any equipment they have. While absorbed, each creature shares my senses and is immune to all damage. They can speak, but their voice is only heard by me and any other absorbed creatures. The only action that absorbed creatures can take is to exit my gift. After one hour, all creatures are forced to exit. I can also force any absorbed creatures to exit as an action. If I fall unconscious or die, the absorbed creatures exit immediately. When a creature exits my gift, it enters the nearest unoccupied space with all of its equipment intact. Once I use this feature, I can't do so again until I finish a long rest.",
				usages : 1,
				recovery : "long rest",
				action : ["action"]
			},
			"subclassfeature10" : {
				name : "Tenacity",
				source : ["HB", 0],
				minlevel : 10,
				description : "\n   " + "I can choose one ability when I finish a short or long rest. I gain proficiency in that ability's saving throws until I choose a different one with this feature.",
			},
			"subclassfeature15" : {
				name : "From the Brink",
				source : ["HB", 0],
				minlevel : 15,
				description : "\n   " + "When I'm reduced to 0 HP but not killed outright, I can instead drop to 1 HP and gain a number of temporary HP equal to my Constitution score * 5. My gift envelops me like a second skin, leaving few openings for a finishing blow. While this form of temporary HP persists, I can use my action to remove any number of them and deal half that much necrotic damage to a creature that I can see within 20 feet of me. Once I use this feature, I can't use it again until I finish a long rest.",
				usages : 1,
				recovery : "long rest",
			},
			"subclassfeature18" : {
				name : "Persistant Concentration",
				source : ["HB", 0],
				minlevel : 18,
				description : "\n   " + "I can't lose my concentration on a spell as a result of taking damage if I'm the spell's only target.",
			},
		}
	}
);
